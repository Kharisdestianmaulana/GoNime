<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forum Diskusi - GoNime Community</title>
    <link rel="icon" href="Go.png" type="image/png" />

    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />

    <link rel="manifest" href="manifest.json" />

    <script src="https://cdn.jsdelivr.net/npm/appwrite@11.0.0"></script>
  </head>
  <body>
    <nav class="navbar">
      <div class="logo">Go<span>Nime</span> Forum</div>

      <div class="nav-right-section">
        <div class="search-box desktop-search">
          <input
            type="text"
            id="search-input"
            placeholder="Cari anime..."
            onkeypress="handleEnter(event)"
          />
          <button onclick="searchAnime()"><i class="fas fa-search"></i></button>
        </div>
        <a
          href="index.html"
          class="nav-icon-link"
          title="Nonton Anime"
          style="color: white; text-decoration: none; margin-right: 15px"
        >
          <i class="fas fa-play-circle"></i>
          <span
            class="desktop-only"
            style="display: inline-block; margin-left: 5px"
            >Nonton</span
          >
        </a>

        <div id="auth-buttons" class="auth-btn-group" style="display: flex">
          <button
            onclick="loginWithProvider('google')"
            class="btn-login google"
            title="Login Google"
          >
            <i class="fab fa-google"></i>
          </button>
          <button
            onclick="loginWithProvider('discord')"
            class="btn-login discord"
            title="Login Discord"
          >
            <i class="fab fa-discord"></i>
          </button>
        </div>

        <div
          id="user-profile-area"
          class="user-profile-area"
          style="display: none"
        >
          <div class="avatar-wrapper" onclick="toggleUserMenu()">
            <img id="user-avatar" src="" alt="User" class="nav-avatar" />
            <span
              id="header-username"
              class="desktop-only"
              style="font-weight: bold; font-size: 0.9rem; margin-left: 8px"
              >User</span
            >
            <i
              class="fas fa-chevron-down dropdown-arrow"
              style="margin-left: 5px"
            ></i>
          </div>

          <div id="user-dropdown" class="user-dropdown">
            <div class="dropdown-header">
              <strong id="user-name-display">Guest</strong>
              <span>Member Setia</span>
            </div>
            <div class="dropdown-body">
              <a href="index.html" onclick="toggleUserMenu()"
                ><i class="fas fa-play"></i> Mulai Nonton</a
              >
              <a href="#" onclick="openQuestModal(); toggleUserMenu()"
                ><i class="fas fa-tasks"></i> Misi Harian</a
              >
              <a href="#" onclick="openSettingsModal(); toggleUserMenu()"
                ><i class="fas fa-cog"></i> Pengaturan</a
              >
              <hr />
              <a href="#" onclick="logoutUser()" class="logout-link"
                ><i class="fas fa-sign-out-alt"></i> Keluar</a
              >
            </div>
          </div>
        </div>
      </div>
    </nav>

    <main class="container" style="margin-top: 90px; min-height: 80vh">
      <div class="forum-header">
        <h1>
          <i class="fas fa-comments" style="color: var(--primary)"></i> Markas
          Diskusi Wibu
        </h1>
        <p style="color: #aaa; margin-top: 10px">
          Tempat nongkrong member GoNime. Sharing rekomendasi, teori konspirasi,
          atau pamer waifu di sini.
        </p>

        <div style="margin-top: 30px">
          <button onclick="openForumModal()" class="btn-primary">
            <i class="fas fa-plus"></i> Buat Topik Baru
          </button>
        </div>
      </div>

      <hr style="border-color: #333; margin: 30px 0" />

      <h3 style="margin-bottom: 20px">
        <i class="fas fa-fire"></i> Diskusi Terbaru
      </h3>

      <div id="forum-posts-container" class="forum-grid">
        <div
          style="
            grid-column: 1/-1;
            text-align: center;
            padding: 50px;
            color: #666;
          "
        >
          <i class="fas fa-spinner fa-spin fa-2x"></i>
          <p style="margin-top: 10px">Sedang memuat diskusi...</p>
        </div>
      </div>
    </main>

    <footer class="pro-footer">
      <div class="footer-content">
        <div class="footer-brand">
          <h2>Go<span>Nime</span> Forum</h2>
          <p>Bagian dari komunitas GoNime Indonesia.</p>
        </div>
        <div class="footer-links">
          <h4>Navigasi</h4>
          <a href="index.html">Kembali ke Home</a>
          <a href="#" onclick="openQuestModal()">Misi Harian</a>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2024 GoNime Indonesia.</p>
      </div>
    </footer>

    <div id="forum-modal" class="modal">
      <div class="modal-content" style="max-width: 600px">
        <span class="close-btn" onclick="closeForumModal()">&times;</span>
        <h3 style="margin-bottom: 20px; text-align: center">
          <i class="fas fa-pen-nib"></i> Tulis Topik Baru
        </h3>

        <div class="settings-form">
          <div class="form-group">
            <label>Judul Topik</label>
            <input
              type="text"
              id="forum-title"
              placeholder="Contoh: Anime Isekai terbaik musim ini apa?"
              style="
                width: 100%;
                padding: 12px;
                background: #111;
                border: 1px solid #333;
                color: white;
                border-radius: 8px;
              "
            />
          </div>

          <div class="form-group" style="margin-top: 15px">
            <label>Isi Diskusi</label>
            <textarea
              id="forum-content"
              rows="6"
              placeholder="Tulis detailnya di sini..."
              style="
                width: 100%;
                padding: 12px;
                background: #111;
                border: 1px solid #333;
                color: white;
                border-radius: 8px;
                resize: vertical;
              "
            ></textarea>
          </div>

          <button
            onclick="submitForumPost()"
            class="btn-primary"
            style="width: 100%; margin-top: 20px; justify-content: center"
          >
            <i class="fas fa-paper-plane"></i> Posting Sekarang
          </button>
        </div>
      </div>
    </div>

    <div id="quest-modal" class="modal">
      <div class="modal-content" style="max-width: 450px">
        <span class="close-btn" onclick="closeQuestModal()">&times;</span>
        <div class="quest-header">
          <h3><i class="fas fa-tasks"></i> Misi Harian</h3>
          <p>Selesaikan misi untuk naik pangkat!</p>
        </div>
        <div id="quest-list" class="quest-list"></div>
      </div>
    </div>

    <div id="user-dropdown-template" style="display: none"></div>

    <div id="view-post-modal" class="modal">
      <div class="modal-content" style="max-width: 700px">
        <span class="close-btn" onclick="closeViewModal()">&times;</span>

        <div style="padding: 20px">
          <div
            style="
              border-bottom: 1px solid #333;
              padding-bottom: 15px;
              margin-bottom: 20px;
            "
          >
            <h2
              id="view-post-title"
              style="color: var(--primary); margin-bottom: 10px"
            >
              Memuat Judul...
            </h2>
            <div
              style="
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 0.9rem;
                color: #aaa;
              "
            >
              <img
                id="view-post-avatar"
                src=""
                style="width: 30px; height: 30px; border-radius: 50%"
              />
              <span id="view-post-author">Nama Penulis</span>
              <span>â€¢</span>
              <span id="view-post-date">Tanggal</span>
            </div>
          </div>

          <div
            id="view-post-content"
            style="
              line-height: 1.8;
              color: #e0e0e0;
              font-size: 1rem;
              white-space: pre-wrap;
            "
          >
            Memuat isi postingan...
          </div>
        </div>
      </div>
    </div>

    <script src="script.js"></script>

    <script>
      // Fungsi Buka Modal (Tetap sama)
      function openForumModal() {
        const profileArea = document.getElementById("user-profile-area");
        // Cek apakah style display-nya "none" (artinya belum login)
        if (profileArea.style.display === "none") {
          alert("Eits, login dulu dong sebelum posting! ðŸ˜…");
          return;
        }
        document.getElementById("forum-modal").style.display = "block";
      }

      function closeForumModal() {
        document.getElementById("forum-modal").style.display = "none";
      }

      // GANTI BAGIAN INI (Pakai addEventListener biar aman)
      window.addEventListener("click", function (event) {
        const forumModal = document.getElementById("forum-modal");
        const viewModal = document.getElementById("view-post-modal");
        if (event.target == forumModal) {
          forumModal.style.display = "none";
        }

        // Tutup Modal Baca Postingan (INI TAMBAHANNYA)
        if (event.target == viewModal) {
          viewModal.style.display = "none";
        }
      });
    </script>
  </body>
</html>
